// Copyright (c) 2023-2026 Dan Oâ€™Malley
// This file is licensed under the MIT License. See LICENSE for details.


typedef unsigned int uint32_t;
typedef unsigned short uint16_t;
typedef unsigned char uint8_t;

// Memory Locations
#define KEYBOARD_BUFFER 0x1000
#define COMMAND_BUFFER ((uint8_t *)0x1040)
#define USER_PID_INFO 0x2000
#define OPEN_BUFFER_TABLE ((uint8_t *)0x2100)
#define RUNNING_PID_LOC ((uint8_t *)0x2FF0)
#define RETURNED_MMAP_PAGE_LOC ((uint8_t *)0x2FF4)
#define CURRENT_FILE_DESCRIPTOR ((uint8_t *)0x2FF8)
#define GDT_LOC 0x7000
#define USER_TEMP_INODE_LOC ((uint8_t *)0x30000)
#define USER_TEMP_FILE_LOC ((uint8_t *)0x31000)
#define VIDEO_AND_BIOS_RESERVED_START 0xA0000
#define VIDEO_RAM ((uint8_t *)0xb8000)
#define SHELL_CURSOR_POS 0xb8be8
#define VIDEO_AND_BIOS_RESERVED_END 0xFFFFF
#define USERPROG_TEXTSEG_START 0x100000
#define USER_HEAP 0x200000
#define TEMP_FILE_START_LOC 0x210000
#define STACK_PAGE 0x2FE000
#define STACK_START_LOC 0x2FF000
#define KERNEL_BASE 0x300000
#define PROCESS_TABLE_LOC 0x348000
#define EXT2_INDIRECT_BLOCK ((uint8_t *)0x349000)
#define KERNEL_TEMP_INODE_LOC ((uint8_t *)0x350000)
#define KERNEL_TEMP_FILE_LOC ((uint8_t *)0x352000)
#define PAGE_DIR_BASE 0x370000
#define PAGE_TABLE_BASE 0x371000
#define INTERRUPT_DESC_TABLE 0x392000
#define INTERRUPT_DESC_TABLE_REG 0x393000
#define KERNEL_HEAP 0x395000
#define PAGEFRAME_MAP_BASE 0x397000
#define OPEN_FILE_TABLE 0x398000
#define KERNEL_HASH_LOC ((uint8_t *)0x39A000)
#define KERNEL_STACK 0x39F000
#define EXT2_TEMP_INODE_STRUCTS ((uint8_t *)0x3A0000)
#define EXT2_BLOCK_USAGE_MAP 0x3F0000
#define EXT2_INODE_USAGE_MAP 0x3F1000
#define EXT2_INDIRECT_BLOCK_TMP_LOC 0x3F2000
#define KERNEL_CONFIGURATION 0x3FC000
#define KERNEL_SEMAPHORE_TABLE 0x3FD000
#define SUPERBLOCK_LOC ((uint8_t *)0x3FF000)
#define BLOCK_GROUP_DESCRIPTOR_TABLE ((uint8_t *)0x3FF600)
#define KERNEL_LIMIT 0x400000
#define LAPIC_ADDR 0xFEE00000

// IO PORTS
#define MASTER_PIC_COMMAND_PORT 0x20
#define MASTER_PIC_DATA_PORT 0x21
#define SLAVE_PIC_COMMAND_PORT 0xA0
#define SLAVE_PIC_DATA_PORT 0xA1
#define PIT_COUNTER_1 0x40
#define PIT_COUNTER_2 0x41
#define PIT_COUNTER_3 0x42
#define PIT_COMMAND_PORT 0x43
#define PIT_DATA_PORT_CHANNEL_0 0x40
#define KEYBOARD_STATUS_PORT 0x64
#define KEYBOARD_DATA_PORT 0x60
#define KEYBOARD_PORT_B 0x61
#define PRIMARY_ATA_DATA_REGISTER 0x1F0
#define PRIMARY_ATA_SECTOR_COUNT_REGISTER 0x1F2
#define PRIMARY_ATA_SECTOR_LOWBYTE_NUMBER 0x1F3
#define PRIMARY_ATA_SECTOR_MIDBYTE_NUMBER 0x1F4
#define PRIMARY_ATA_SECTOR_HIGHBYTE_NUMBER 0x1F5
#define PRIMARY_ATA_DRIVE_HEADER_REGISTER 0x1F6
#define PRIMARY_ATA_COMMAND_STATUS_REGISTER 0x1F7
#define ATA_READ 0x20
#define ATA_WRITE 0x30

// Constants
#define KEYBOARD_BUFFER_SIZE 0x40
#define INTERRUPT_MASK_ALL_ENABLED 0x0
#define INTERRUPT_MASK_SYSTEM_TIMER_ONLY 0xFE
#define INTERRUPT_MASK_KEYBOARD_ONLY 0xFD
#define INTERRUPT_MASK_SYSTEM_TIMER_AND_KEYBOARD_ONLY 0xFC
#define INTERRUPT_MASK_ALL_DISABLED 0xFF
#define INTERRUPT_END_OF_INTERRUPT 0x20
#define BLOCK_SIZE 0x400
#define SECTOR_SIZE 0x200
#define PAGE_SIZE 0x1000
#define MAX_PGTABLES_SIZE 0x2000
#define HEAP_OBJ_SIZE 0x20
#define HEAP_OBJ_USABLE_SIZE ((int)HEAP_OBJ_SIZE - 2) // 1 byte for PID and and extra byte for null
#define MAX_HEAP_OBJECTS 0x80
#define SEMAPHORE_SIZE 0x10
#define MAX_SEMAPHORE_OBJECTS 0x80
#define TASK_STRUCT_SIZE 0xA8
#define PROC_SLEEPING 0x1
#define PROC_RUNNING 0x2
#define PROC_ZOMBIE 0x3
#define PROC_KILLED 0x4
#define MAX_PROCESSES 0x10
#define MAX_PROCESS_SIZE 0x400000
#define PAGEFRAME_MAP_SIZE 0x400
#define MAX_FILE_DESCRIPTORS 0xF
#define MAX_SYSTEM_OPEN_FILES 0x80
#define MAGIC_ELF 0x464C457F
#define ELF_PROGRAM_HEADER_SIZE 0x20
#define INODE_SIZE 0x80
#define EXT2_SECTOR_START 0x100
#define EXT2_SUPERBLOCK_SECTOR_START (EXT2_SECTOR_START + 2)
#define EXT2_NUMBER_OF_DIRECT_BLOCKS 0xC
#define EXT2_FIRST_INDIRECT_BLOCK 0xC
#define EXT2_DIRECTORY_ENTRY_FILE 0x8
#define EXT2_DIRECTORY_ENTRY_DIR 0x4
#define MAX_FILES_PER_DIRECTORY 0x80
#define INODES_PER_BLOCK (BLOCK_SIZE / INODE_SIZE) 
#define SUPERBLOCK 0x1
#define GROUP_DESCRIPTOR_BLOCK 0x2
#define ROOTDIR_BLOCK 0x2A
#define ROOTDIR_INODE 0x2
#define SOUND_MODE_3_SQUARE_WAVE 0xB6
#define SECONDS_IN_MIN 60
#define SECONDS_IN_HOUR 3600
#define SECONDS_IN_DAY 86400
#define SECONDS_IN_YEAR 31536000
#define PIT_FREQUENCY 1193182
#define SYSTEM_INTERRUPTS_PER_SECOND 150


// User Interface
#define ASCII_HORIZONTAL_LINE 0xC4
#define ASCII_VERTICAL_LINE 0xB3
#define ASCII_UPPERLEFT_CORNER 0xDA
#define ASCII_UPPERRIGHT_CORNER 0xBF
#define ASCII_LOWERLEFT_CORNER 0xC0
#define ASCII_LOWERRIGHT_CORNER 0xD9
#define COLOR_GREEN 0x3
#define COLOR_WHITE 0xF
#define COLOR_LIGHT_BLUE 0x9
#define COLOR_RED 0xC

// Permissions
#define PG_KERNEL_PRESENT_RW 0x3
#define PG_USER_PRESENT_RO 0x5
#define PG_USER_PRESENT_RW 0x7
#define PAGEFRAME_AVAILABLE 0x00
#define KERNEL_OWNED 0xFF
#define RDONLY 0x1
#define RDWRITE 0x2
#define FILE_LOCKED 0xFF

// System Calls
#define SYS_SOUND 0x1
#define SYS_OPEN 0x2
#define SYS_WRITE 0x3
#define SYS_CLOSE 0x4
#define SYS_PS 0x5
#define SYS_FORK_EXEC 0x6
#define SYS_EXIT 0x7
#define SYS_FREE 0x8
#define SYS_MMAP 0x9
#define SYS_KILL 0xA
#define SYS_SWITCH_TASK 0xB
#define SYS_MEM_DUMP 0xC
#define SYS_UPTIME 0xD
#define SYS_SWITCH_TASK_TO_PARENT 0xE
#define SYS_WAIT 0xF
#define SYS_DIR 0x10
#define SYS_TOGGLE_SCHEDULER 0x11
#define SYS_SHOW_OPEN_FILES 0x12
#define SYS_BEEP 0x13
#define SYS_CREATE 0x14
#define SYS_DELETE 0x15
#define SYS_OPEN_EMPTY 0x16
